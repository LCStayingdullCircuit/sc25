# sc25

# Installation and Deployment

> **Requirements:**  
> Ensure all software dependencies (such as CUDA, GCC, Python) are installed as specified in the project documentation.

## 1. Clone the Artifact Repository

```shell
git clone --recursive https://github.com/LCStayingdullCircuit/sc25.git
```

## 2. Install Python Dependencies

If not already installed, run:

```shell
pip install -r requirements.txt
```

## 3. Build C++/CUDA Code

> **Note:** Replace `/yourpath/` with your actual directory path in all commands and environment variables below.

```shell
# Compile cuMpSGEMM
cd sc25/Tensor-BLAS/cuMpSGEMM
mkdir build
cd build
cmake ..
make -j4    # Building may take up to 15 minutes

# Compile Tensor-BLAS
cd ../../build
make

# Set library paths
export LD_LIBRARY_PATH="/yourpath/Tensor-BLAS/build:/yourpath/Tensor-BLAS/cuMpSGEMM/build"

# Compile mixed_precision_lls
# (Replace 'yourpath' with your path in the Makefile if necessary)
cd ../..
make -j
```

Upon successful compilation, the executables will be available in the `bin` directory.

After completing the above steps, your system will be ready to run the experiments.


## Experimental Parameters

| Parameter       | Description                                                             |
| --------------- | ----------------------------------------------------------------------- |
| `m`             | Number of rows of the matrix                                            |
| `n`             | Number of columns of the matrix                                         |
| `nb`            | Block size for the large block in double-blocking                       |
| `b`             | Block size for the small block in double-blocking                       |
| `datatype`      | Type of data (integer 1--6)                                             |
| `condition`     | Condition number                                                        |


# Experiment Workflow

The workflow and dependencies are as follows:

## T1: Consistency Analysis (Supports Claim C1)

- **Execution:**  
    ```shell
    ./bin/cgls_Iteration m n nb datatype condition
    ./bin/halfAR_inv m n nb datatype condition
    ```
- **Process:**  
  - Runs the CGLS iteration and (optionally) additional matrix analysis (low-precision preconditioning or matrix property analysis).
- **Output:**  
  - Iteration residual data for the CGLS methods and matrix singular values.

---

## T2: QR Performance Benchmark (Supports Claim C3)

- **Execution:**  
    ```shell
    ./bin/double_blocking_QR m n nb b datatype condition
    ```
- **Process:**  
  - Benchmarks the double-blocking QR factorization.
- **Output:**  
  - TFLOPS performance results for the QR algorithm.

---

## T3: Full Mixed-Precision LLS Solver Benchmark (Supports Claim C4)

- **Execution:**  
    ```shell
    python runcgls_mixedLLS.py m n nb b datatype condition
    python runcgls_original.py m n nb b datatype condition
    ```
- **Process:**  
  - `runcgls_mixedLLS.py`: Mixed-precision LLS solver; workflow includes optional high-precision reference solve, model prediction, solver selection, execution, and recording results.
  - `runcgls_original.py`: Baseline LLS solver; includes low-precision QR, iterative refinement, fallback to high-precision QR as necessary.
- **Output:**  
  - Performance data such as time, iterations, and accuracy for each tested configuration and solver.

---

## T4: Result Aggregation and Plotting (Generates Figures)

- **Input:**  
  - Raw data files generated by T1, T2, and T3.
- **Execution:**  
  - Run plotting scripts in the `draw` directory. See `draw/README.md` for detailed instructions (some figures may have data embedded in scripts for reproducibility).
- **Output:**  
  - Figures matching those presented in the paper (e.g., QR performance, LLS solver performance, consistency analysis).

---

### Dependencies

- **T1, T2, T3**: Can run in parallel once compilation is complete.
- **T4**: Requires completion of T1, T2, and T3.

---

### Key Experimental Parameters

- **Numerical Precisions:**  
  - Low precision: IEEE FP16 (half-precision)  
  - High precision: IEEE FP64 (double-precision)

- **Iteration Counts/Tolerance:**  
  - Maximum iterations: 50  
  - Relative residual tolerance: 1e-13

- **QR Algorithm Parameters:**  
  - Recommended inner block size (`b`): 32  
  - Recommended outer block size (`nb`): 1024

- **Hardware:**  
  - All performance results are obtained on an NVIDIA H100 PCIe GPU. Results may vary on different hardware.

---

# Output Files

When the main experiment script (such as `run_experiments.sh`) completes successfully, you will find:

## Raw Data Files (`.txt` or `.csv`)

- `res_<condition>_<datatype>_nonpre.txt`, `res_<condition>_<datatype>_pre.txt`:  
    - Residual norm per iteration for standard and preconditioned CGLS (T1).
- `singular_<condition>_<datatype>.txt`:  
    - Singular values from consistency analysis (T1).
- QR benchmark TFLOPS results (T2).
- Mixed-precision and baseline LLS solver performance logs (T3).

## Figure Files

- Generated by scripts in the `draw` directory (T4).
- Figures match those in the paper (e.g., QR performance, LLS solver, consistency analysis).
- Read `draw/README.md` for figure-specific generation instructions.
- Complex plots (e.g., stacked bar charts) may have data embedded directly in plotting scripts; convergence curves and singular value plots are usually generated directly from raw `.txt` data.

